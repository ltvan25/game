<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Catch the Cake üéÇ ‚Äì Happy Birthday</title>
  <style>
    :root{
      --bg1:#ffd3a5;--bg2:#fd6585;--primary:#fff;--accent:#7c3aed;--shadow:rgba(0,0,0,.25);
      --btn:rgba(255,255,255,.2);
    }
    *{box-sizing:border-box}
    html,body{height:100%;}
    body{
      margin:0; overflow:hidden; font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Apple Color Emoji","Segoe UI Emoji";
      background: radial-gradient(1200px 800px at 50% -10%, #fff8, transparent 60%), linear-gradient(135deg,var(--bg1),var(--bg2));
      user-select:none; -webkit-user-select:none; touch-action:none;
    }

    /* Game area */
    #game{position:fixed; inset:0;}
    .ground{position:absolute; left:0; right:0; bottom:0; height:80px;
      background:linear-gradient(#0000,#0002), radial-gradient(ellipse at top, #ffffff55, #ffffff00 60%), linear-gradient(0deg,#0002,#0000);
    }

    /* Player (rabbit) */
    .player{position:absolute; bottom:80px; left:50%; transform:translateX(-50%);
      width:90px; height:90px; display:grid; place-items:center;
      border-radius:20px; background:#ffffff22; backdrop-filter:blur(6px);
      box-shadow:0 10px 20px var(--shadow);
    }
    .player .rabbit{font-size:56px; line-height:1;}

    /* Falling cake */
    .cake{position:absolute; top:-60px; font-size:44px; filter:drop-shadow(0 6px 8px var(--shadow));}

    /* HUD */
    .hud{position:fixed; top:12px; right:12px; color:#fff; font-weight:700; text-shadow:0 3px 10px var(--shadow);}
    .badge{background:#00000030; padding:.35rem .6rem; border-radius:12px; margin-left:.4rem}

    /* Mobile controls */
    .controls{position:fixed; inset-inline:0; bottom:14px; display:flex; justify-content:center; gap:14px; pointer-events:auto;}
    .btn{min-width:84px; min-height:84px; border-radius:22px; border:2px solid #fff7; background:var(--btn);
      backdrop-filter:blur(6px); box-shadow:0 8px 18px var(--shadow);
      font-size:28px; color:#fff; display:grid; place-items:center; user-select:none;
      -webkit-tap-highlight-color: transparent;
    }
    .btn:active{transform:translateY(2px)}

    /* Start / Card modal */
    .center{position:fixed; inset:0; display:grid; place-items:center;}
    .panel{background:linear-gradient(135deg,#ffffffdd,#ffe9f5dd); border:2px solid #fff; box-shadow:0 20px 50px var(--shadow);
      padding:20px 22px; border-radius:24px; text-align:center; max-width:min(92vw,480px);
    }
    .panel h2{margin:.3rem 0 0.6rem; font-size:clamp(22px,4.8vw,32px)}
    .panel p{margin:.2rem 0 .8rem; opacity:.85}
    .panel .cta{display:inline-block; margin-top:.4rem; padding:.7rem 1.1rem; border-radius:16px; font-weight:800; color:#fff;
      background:linear-gradient(90deg,#7c3aed,#ec4899); text-decoration:none; border:none; cursor:pointer;}

    /* Birthday card content */
    .card{display:none; position:fixed; inset:0; place-items:center;}
    .card.show{display:grid}
    .card .panel{animation:pop .6s ease both}
    @keyframes pop{from{transform:scale(.7); opacity:0} to{transform:scale(1); opacity:1}}

    .cake-art{margin:10px auto 6px; width:140px; height:110px; position:relative}
    .cake-art .layer{position:absolute; left:10px; right:10px; height:28px; border-radius:10px;}
    .cake-art .layer:nth-child(1){bottom:0;background:#f59e0b}
    .cake-art .layer:nth-child(2){bottom:28px;background:#ef4444}
    .cake-art .layer:nth-child(3){bottom:56px;background:#a855f7}
    .candle{position:absolute; left:50%; transform:translateX(-50%); top:-26px; width:18px; height:26px; background:#fde68a; border-radius:6px}
    .flame{position:absolute; left:50%; transform:translateX(-50%); top:-42px; width:14px; height:22px; background:orange; border-radius:50%; animation:flicker .25s infinite}
    @keyframes flicker{0%,100%{transform:translateX(-50%) scaleY(1); background:gold}50%{transform:translateX(-50%) scaleY(1.2); background:orange}}

    /* Fireworks particles */
    .fw{position:fixed; width:6px; height:6px; border-radius:50%; pointer-events:none}
  </style>
</head>
<body>

  <div id="game">
    <div class="player" id="player" aria-label="Rabbit catcher" role="img">
      <div class="rabbit">üêá</div>
    </div>
    <div class="ground"></div>
  </div>

  <div class="hud">ƒêi·ªÉm: <span id="score">0</span> <span class="badge">M·ª•c ti√™u: <span id="goal">5</span></span></div>

  <!-- Start panel -->
  <div class="center" id="start">
    <div class="panel">
      <h2>üéÇ Catch the Cake ‚Äì B·∫Øt b√°nh sinh nh·∫≠t</h2>
      <p>Di chuy·ªÉn con th·ªè ƒë·ªÉ <b>h·ª©ng b√°nh üç∞</b> r∆°i xu·ªëng.</p>
      <p><small>M√°y t√≠nh: ‚Üê ‚Üí (ho·∫∑c A/D) ‚Ä¢ ƒêi·ªán tho·∫°i: n√∫t Tr√°i/Ph·∫£i.</small></p>
      <button class="cta" id="startBtn">B·∫Øt ƒë·∫ßu</button>
    </div>
  </div>

 <!-- Win card -->
<div class="card" id="card">
  <div class="panel">
    <h2 style="transform:rotate(-1.5deg)">üéâ Happy Birthday üéâ</h2>
    <p style="font-size:1.2em; margin-top:.2rem">Check mail ‚úâÔ∏è</p>

    <!-- B√°nh sinh nh·∫≠t m·ªõi -->
    <div class="cake-pretty">
      <div class="cake-emoji">üéÇ</div>
      <div class="candle"></div>
      <div class="flame"></div>
    </div>

    <div style="font-size:56px; margin:.2rem 0">üêá</div>
    <button class="cta" id="againBtn">Ch∆°i l·∫°i</button>
  </div>
</div>


  <!-- Mobile controls -->
  <div class="controls" id="controls" aria-hidden="true">
    <div class="btn" id="leftBtn">‚üµ</div>
    <div class="btn" id="rightBtn">‚ü∂</div>
  </div>

  <script>
    // ===== Settings =====
    const targetScore = 5; 
    const spawnBase = 1000; 
    const speedBase = 2.2;  

    // ===== State =====
    const game = document.getElementById('game');
    const player = document.getElementById('player');
    const scoreEl = document.getElementById('score');
    const goalEl  = document.getElementById('goal');
    const startUI = document.getElementById('start');
    const cardUI  = document.getElementById('card');
    const againBtn= document.getElementById('againBtn');
    goalEl.textContent = targetScore;

    let score=0, running=false, px=window.innerWidth/2, vx=0, leftHeld=false, rightHeld=false;
    let cakes = new Set();
    let lastSpawn=0, spawnEvery=spawnBase, speedMul=1;

    const clamp=(v,min,max)=>Math.min(max,Math.max(min,v));

    function spawnCake(){
      const el=document.createElement('div');
      el.className='cake';
      el.textContent='üç∞';
      el.style.left = Math.round(Math.random()*(window.innerWidth-40))+'px';
      el.dataset.y = '-40';
      el.dataset.v = (speedBase + Math.random()*1.3)*speedMul; 
      game.appendChild(el);
      cakes.add(el);
    }

    function updateCakes(){
      const pb = player.getBoundingClientRect();
      cakes.forEach(el=>{
        let y=parseFloat(el.dataset.y)+parseFloat(el.dataset.v);
        el.dataset.y=y; el.style.transform=`translateY(${y}px)`;
        const r = el.getBoundingClientRect();
        const hit = !(r.right < pb.left+10 || r.left > pb.right-10 || r.bottom < pb.top || r.top > pb.bottom);
        if(hit){
          catchCake(el);
        }else if(r.top>window.innerHeight){
          el.remove(); cakes.delete(el);
        }
      });
    }

    function catchCake(el){
      const rect=el.getBoundingClientRect();
      fireworks(rect.left+rect.width/2, rect.top+rect.height/2, 24, 80);
      el.remove(); cakes.delete(el);
      score++; scoreEl.textContent=score;
      speedMul = 1 + Math.min(0.8, score*0.06); 
      spawnEvery = Math.max(420, spawnBase - score*60); 
      if(score>=targetScore){
        win();
      }
    }

    function win(){
      running=false;
      for(let i=0;i<4;i++){
        setTimeout(()=>fireworks(window.innerWidth/2, window.innerHeight/2, 140, 260, true), i*250);
      }
      cardUI.classList.add('show');
    }

    function reset(){
      score=0; scoreEl.textContent=0; speedMul=1; spawnEvery=spawnBase; lastSpawn=0; px=window.innerWidth/2; vx=0;
      cakes.forEach(c=>c.remove()); cakes.clear();
      player.style.left = (px-45)+'px';
      cardUI.classList.remove('show');
      startUI.style.display='none';
      running=true; requestAnimationFrame(loop);
    }

    function fireworks(x,y,count=100, radius=200, rainbow=false){
      for(let i=0;i<count;i++){
        const p=document.createElement('div');
        p.className='fw';
        const hue = rainbow? Math.floor(Math.random()*360): (200+Math.random()*40);
        p.style.background=`hsl(${hue} 90% 60%)`;
        p.style.left=x+'px'; p.style.top=y+'px';
        document.body.appendChild(p);
        const a=Math.random()*Math.PI*2; const d=Math.random()*radius; const dx=Math.cos(a)*d; const dy=Math.sin(a)*d;
        p.animate([
          { transform:'translate(0,0)', opacity:1 },
          { transform:`translate(${dx}px, ${dy}px)`, opacity:0 }
        ], { duration:1200+Math.random()*600, easing:'cubic-bezier(.2,.6,.3,1)'});
        setTimeout(()=>p.remove(), 1900);
      }
    }

    function loop(ts){
      if(!running) return;
      if(!lastSpawn) lastSpawn=ts; if(ts-lastSpawn>spawnEvery){ spawnCake(); lastSpawn=ts; }
      const speed = 6 + score*0.4; 
      vx = (leftHeld? -1:0) + (rightHeld? 1:0);
      px = clamp(px + vx*speed, 45, window.innerWidth-45);
      player.style.left = (px-45)+"px";
      updateCakes();
      requestAnimationFrame(loop);
    }

    function key(e,down){
      if(e.code==='ArrowLeft' || e.code==='KeyA') leftHeld=down;
      if(e.code==='ArrowRight'|| e.code==='KeyD') rightHeld=down;
    }
    addEventListener('keydown',e=>{key(e,true)});
    addEventListener('keyup',e=>{key(e,false)});

    const leftBtn=document.getElementById('leftBtn');
    const rightBtn=document.getElementById('rightBtn');
    function bindHold(btn, set){
      const on=()=>{ set(true) }; const off=()=>{ set(false) };
      btn.addEventListener('pointerdown',on); btn.addEventListener('pointerup',off);
      btn.addEventListener('pointerleave',off); btn.addEventListener('pointercancel',off);
    }
    bindHold(leftBtn, v=>leftHeld=v);
    bindHold(rightBtn, v=>rightHeld=v);

    document.getElementById('startBtn').addEventListener('click', ()=>{ reset(); });
    againBtn.addEventListener('click', ()=>{ reset(); });

    addEventListener('resize', ()=>{ px=clamp(px,45,window.innerWidth-45); player.style.left=(px-45)+'px'; });

    document.getElementById('controls').addEventListener('touchstart', e=>{ e.preventDefault(); }, {passive:false});
  </script>
</body>
</html>
